\chapter{The problem}
\label{sec:problem}

\iffalse

Background definitions, notations, etc.
Problem definition
	- Relation to Helmholtz
Boundary condition
	- Sommerfeld
	- PML/ABC/DtN
Shifted Laplace operator


The Poisson problem:
	- Well behaved
	- Eigenvalues of the residual
	- Optimal method for finding solution

Helmholtz problem:
	- Misbehaved
	- Poor convergence
	- Indefinite discretisation matrix
\fi

We wish to solve the Helmholtz equation in cylindrical coordinates in an unbounded three-dimensional domain, with symmetry about the $z$-axis.
Exploiting the symmetry of the domain allows us to decompose the solution into its Fourier components.
This has the advantage that the problem reduces to two dimensions.

In this chapter, we will derive the formal statement of the problem starting from the wave equation.
Also included here is a discussion of the topics relevant to the practical solution of the problem.
The outcome of this chapter should be the starting point for the finite element discretisation in chapter \ref{sec:fem}.




% ------------------------------

\section{Problem derivation}

Consider the three dimensional wave equation with wave speed $c$ in an unbounded domain,
\begin{equation}
	\frac{1}{c^2} \frac{\partial^2 u(x,y,z,t)}{\partial t^2} = \nabla^2 u(x,y,z,t). \label{eqn:wave}
\end{equation}
Assuming the existence of a separable solution where the time component of the solution is time-harmonic with frequency $\omega$,
we may write the real-valued solution as
\[
	u(x,y,z,t) = \Re \left( U(x,y,z)e^{-i\omega t} \right),
\]
where $U(x,y,z)$ is a complex-valued function \cite{oomph_hh}.
Substituting this into \eqref{eqn:wave}, we obtain the Helmholtz equation
\begin{equation}
	\nabla^2 U(x,y,z) + k^2 U(x,y,z) = 0, \label{eqn:hh}
\end{equation}
where $k=\omega/c$ is the wavenumber.

The mapping between Cartesian coordinates $(x,y,z)$ and cylindrical polar coordinates $(r,\varphi,z)$ is given by
\begin{align}
	x &= r\cos(\varphi), \\
	y &= r\sin(\varphi), \\
	z &= z.
\end{align}
The Jacobian of this mapping is given by
\begin{align}
	J = \left\vert \frac{\partial(x,y,z)}{\partial(r,\varphi,z)} \right\vert = r. \label{eqn:cylindrical_mapping}
\end{align}

This mapping transforms our equation from $U(x,y,z)$ into $U(r,\varphi,z)$, 
which we may decompose into its Fourier components $u_N(r,z)$ around the $\varphi$ axis, so that
\begin{equation}
	U(r,\varphi,z) = \sum_{N=-\infty}^\infty u_N(r,z) e^{iN\varphi}. \label{eqn:full_eqn}
\end{equation}
By linearity of the Helmholtz equation, for each $N$, $u_N(r,z)$ must satisfy the Helmholtz equation.
This allows us to solve for each $N$ individually and then combine the solutions to form a full solution.

The Laplacian in cylindrical coordinates is given by
\begin{align}
	\nabla^2 = \frac{\partial^2 }{\partial r^2}
			 + \frac{1}{r} \frac{\partial }{\partial r}
			 + \frac{1}{r^2} \frac{\partial^2 }{\partial \varphi^2}
			 + \frac{\partial^2 }{\partial z^2}. \label{eqn:laplacian}
\end{align}
We also define the reduced Laplacian in cylindrical coordinates, consisting of only partial derivatives with respect to $r$ and $z$.
\begin{align}
	\nabla^2 = \frac{\partial^2 }{\partial r^2}
			 + \frac{1}{r} \frac{\partial }{\partial r}
			 + \frac{\partial^2 }{\partial z^2}. \label{eqn:laplacian_reduced}
\end{align}
It is not necessary to distinguish between the two operators \eqref{eqn:laplacian} and \eqref{eqn:laplacian_reduced}.
In the case of a function in $(r,\varphi,z)$, then the full cylindrical Laplacian is required.
Alternatively, for a function in $(r,z)$, the reduced cylindrical Laplacian is appropriate.
Therefore it should be implicit from the context of the equation.

Hence above, we wish to extract those terms consisting of $\varphi$ from \eqref{eqn:full_eqn}.
The partial derivatives with respect to $\varphi$ give
\begin{align}
	\frac{1}{r^2} \frac{\partial^2 }{\partial \varphi^2} \left( e^{i N \varphi}\right) = - \frac{N^2}{r^2} e^{i N \varphi}.
\end{align}
The full equation then becomes
\begin{align}
	\nabla^2 U(r,\varphi,z) 
		&= \nabla^2 \left[\sum_{N=-\infty}^\infty u_N(r,z) e^{i N \varphi}\right] \\
		&= \sum_{N=-\infty}^\infty \left[ 
										\nabla^2 u_N(r,z) - \frac{N^2}{r^2}u_N(r,z)
								   \right] e^{i N \varphi}.
\end{align}

Since we can solve each term in the series separately, we can extract a single equation for each $N$.
This gives us the Fourier decomposed Helmholtz equation,
\begin{equation}
	\nabla^2 u_N(r,z) + (k^2 - \frac{N^2}{r^2})u_N(r,z) = 0. \label{eqn:fhh}
\end{equation}

The standard Helmholtz equation is classified by a single parameter, the wavenumber $k$.
Decomposing the solution into Fourier components, we introduce the Fourier wavenumber $N$ as an additional parameter to the system.
These two parameters together classify solutions for the problem.







% ----------------------------------------

\subsection{Complex-shifted Laplacian}

As mentioned above, there are some difficulities in solving the Helmholtz equation using multigrid.
That is especially the case for even moderate values of $k^2$.
Work has been done by several authors in order to overcome this shortcoming of multigrid <<CITATION>>.
This is done by introducing a shift to the $k^2$ term in the Helmholtz operator into the complex plane.

In Cartesian coordinates, the Laplacian operator with a complex shift is
\begin{align}
	\mathcal{L}_{CSLP} = \nabla^2 + (1 + i \alpha ) k^2,  \label{eqn:cslp}
\end{align}
where $\alpha$ is a positive real number controlling the offset from the real axis.

In cylindrical coordinates, we obtain the same equation with the shift applied to the $k^2$ term.
Therefore, in our Fourier decomposed cylindrical coordinates, we have
\begin{align}
	\nabla^2 u_N(r,z) + \left[ \left( 1 + i \alpha \right) k^2 - \frac{N^2}{r^2} \right] u_N(r,z) = 0.
\end{align}


The optimal value of $\alpha$ is determined in \cite{cslp2}




% SOME MORE DISCUSSION ABOUT THE CSLP
% WHAT VALUE OF ALPHA DO WE CHOOSE?
% WHAT WERE THE RESULTS FROM THE PAPER GIVEN
% HOW DOES IT BEHAVE IN CARTESIAN/CYLINDRICAL FROM LITERATURE








% ----------------------------------------

\section{Related problems and other issues}

In the case where $k=0$, the problem reduces to the Poisson problem.
Taking $k=0$ in equation \eqref{eqn:fhh}, we obtain
\begin{align}
	\nabla^2 U(r,\varphi,z) = \nabla^2 u_N(r,z) - \frac{N^2}{r^2} u_N(r,z) = 0. \label{eqn:fp}
\end{align}
This is the Fourier decomposed Poisson equation in cylindrical coordinates.

The Poisson equation is of interest because of the close relation between the Helmholtz and Poisson equations.
Since we are interested in how multigrid performs when solving \eqref{eqn:fhh}, we will compare results with related problems.

Another related problem is the case when both $k=0$ and $N=0$.
This is the Poisson equation in reduced coordinates, with a solution depending only on $r$ and $z$.
To further aid in comparison between solutions, we will also consider this case.


% Variable coefficients --------------

A common issue with multigrid occurs with variable coefficient problems.
\cite{briggs}
% To demonstrate this, 
% Consider the one dimensional equation
% \begin{align}
% 	\left( a(x)u'(x) \right)' = f(x)
% \end{align}
% This is generally an issue when $a(x)$ is highly variable.

In Cartesian coordinates, the Helmholtz equation is a constant coefficient problem.
The operator we have in this case is
\begin{align}
	\nabla^2 + k^2 = \frac{\partial^2}{\partial x^2} + \frac{\partial^2}{\partial t^2} + \frac{\partial^2}{\partial z^2} + k^2.
\end{align}
Taking $k=0$, we obtain the Laplace operator.
This is especially well behaved for multigrid methods.
Aside from the issues mentioned above, particularly with matrices becoming indefinite for larger values of $k^2$, this equation has constant coefficients.
Therefore, combining the preconditioning discussed in section \ref{sec:precond}, multigrid should converge appropriately.
Indeed, the multigrid implementation within \oomph for the Cartesian solver behaves as expected.

In cylindrical coordinates, however, we have a term that varies proportional to the inverse of the radial distance squared.
For the full Fourier decomposed Helmholtz equation, recall equation \eqref{eqn:fhh},
\begin{align}
	\frac{\partial^2 u_N}{\partial r^2}
			 + \frac{1}{r} \frac{\partial u_N}{\partial r}
			 + \frac{\partial^2 u_N}{\partial z^2}
			 + (k^2 - \frac{N^2}{r^2})u_N = 0. \label{eqn:full_fhh}
\end{align}

Before any theoretical work to attempt to remedy issues arising from variable coefficients, we should first be certain that a problem exists with multigrid applied to the cylindrical problem.
Since the implementation of multigrid within \oomph exists for the Cartesian case, we can begin here.
With some slight modifications, the same code can be used to solve the problem in cylinderical coordinates.
% Mention the changes made?
Running the modified code to compute a solution resulted in a failure.
The general error was lack of convergence in the FGMRES solver.
To deduce the precide nature of the error, more analysis of the problem is necessary.









% ----------------------------------------

\section{Domain and boundary conditions}

The full wave equation \eqref{eqn:wave} is defined in three spatial dimensions and one temporal dimension.
Given the assumptions above, in particular the time-harmonic solution and the axisymmetric domain, we reduce the problem to two spacial dimensions.
Figure \ref{fig:full_domain} represents an example of the domain in full 3D cylindrical coordinates.
On the other hand, figure \ref{fig:reduced_domain} shows the resulting domain after dimension reduction from the Fourier decomposition.
This simplification aids in the computational work by reducing the number of degrees of freedom of the problem.
It is only a matter of post-processing the solution to obtain the full 3D solution from the reduced computed solution, as nothing is lost due to symmetry.

To complete the problem formulation, boundary conditions must also be specified for the PDE.
Since our equation is of elliptic type, any appropriate Dirichlet, Neumann, or Robin conditions will suffice.
Each boundary condition has its own physical interpretation, and therefore influences the solution differently.

As waves propagate through a medium, they may eventually arrive at a boundary, or continue travelling through space unimpeded.


When a wave meets a boundary, depending on the boundary material properties, 





% The sharp edges at the corners of the domain are generally not a problem.
% Absorbing boundary conditions take care of that.





In addition to the boundary conditions, an additional condition on the solution must be imposed to ensure that the solution is unique since the domain of the problem is infinite.
The Sommerfeld radiation condition
\[
\lim_{|x|\rightarrow \infty} |x|^{\frac{n-1}{2}} \left( \frac{\partial}{\partial |x|} - ik \right) u(x) = 0, \label{eqn:sommerfeld}
\]
achieves this by ensuring that sources scatter to infinity and do not come from infinity \cite{sommerfeld}.


\begin{figure}[ht!]
	% Need an example image of a 3d cylinder - the domain for the problem -- away from the 
	% Also the 2d section of the cylinder
	\centering
	\subfloat[][Full cylindrical domain. \label{fig:full_domain}]{
\begin{tikzpicture}[scale=2.5, >=latex]
  % AXES
  % z-axis
  \draw[->] (0.5,0) -- (0.5,1.7) node[left, scale=1.3] {$z$};
  % r-axis
  \draw[->] (0.5,0) -- (1.7,0) node[below, scale=1.3] {$r$};
  % phi-axis
  \draw[->] (0.5,0) -- (0.1,-0.4) node[left, scale=1.3] {$\varphi$};

  % INNER CYLINDER
  % top ellipse
  \draw[solid] (0.5,1.2) ellipse (0.3 and 0.09);
  % bottom ellipse
  \draw[dashed] (0.5,0) ellipse (0.3 and 0.09);
  
  % left line
  \draw[dashed] (0.2,0) -- ++(0,1.2);
  % right line
  \draw[dashed] (0.8,0) -- ++(0,1.2);


  % OUTER CYLINDER
  % top ellipse
  \draw[solid] (1.5,1.2) arc (0:180:1 and 0.3);
  \draw[solid] (-0.5,1.2) arc (180:360:1 and 0.3);
  % bottom ellipse
  \draw[dashed] (1.5,0) arc (0:180:1 and 0.3);
  \draw[solid] (-0.5,0) arc (180:360:1 and 0.3);
  
  % left line
  \draw (-0.5,0) -- ++(0,1.2);
  % right line
  \draw (1.5,0) -- ++(0,1.2);
\end{tikzpicture}	
	}\quad
	\subfloat[][Reduced dimensional domain. \label{fig:reduced_domain}]{
		\begin{tikzpicture}[scale=3, >=latex]
  % z-axis
  \draw[->] (0,0) -- ++(0,1.6) node[left, scale=1.3] {$z$};
  % r-axis
  \draw[->] (0,0) -- ++(1.7,0) node[below, scale=1.3] {$r$};

  \draw[solid] (0.3,0.15) -- ++(1,0) -- ++(0,1.2) -- ++(-1,0);
  \draw[dashed] (0.3,0.15) -- ++(0,1.2);

\end{tikzpicture}
	}
	\caption{Problem domain.\label{fig:problem_domain}}
\end{figure}









% --------------------------------------

\section{An analytical solution}

In order to show that the computed solution of a numerical method is producing accurate results, a known solution is required to validate results.
The 3D axisymmetric domain reduces to a 2D rectangle that sweeps around the $z$-axis.
Hence, we want to find an analytical solution on a rectangle in $r$ and $z$ coordinates.

Let us begin by assuming the existence of a separable solution,
\begin{align}
	u_N(r,z) = R(r)Z(z).
\end{align}
Substituting into \eqref{eqn:fhh}, we obtain
\begin{align}
	\left( \frac{\d^2 R(r)}{\d r^2} + \frac{1}{r} \frac{\d R(r)}{\d r} \right) Z(z) + \frac{\d^2 Z(z)}{\d z^2} R(r) + \left( k^2 - \frac{N^2}{r^2} \right) R(r) Z(z) = 0.
\end{align}
Dividing through by $R(r)Z(z)$, we can separate terms consisting of $r$ and $z$ on each side of the equation.
\begin{align}
	\left( \frac{\d^2 R(r)}{\d r^2} + \frac{1}{r} \frac{\d R(r)}{\d r} \right)\frac{1}{R(r)} + \left( k^2 - \frac{N^2}{r^2} \right) = - \frac{\d^2 Z(z)}{\d z^2} \frac{1}{Z(z)}.
\end{align}
Because both sides of this equation are equal expressions involving different variables, they must be equal to some constant, say $\lambda$, whose sign is yet to be determined.
Hence, we obtain two ordinary differential equations in $r$ and in $z$.
\begin{align}
	&\frac{\d^2 Z(z)}{\d z^2} + \lambda Z(z) = 0. \label{eqn:Z}\\
	&\frac{\d^2 R(r)}{\d r^2} + \frac{1}{r} \frac{\d R(r)}{\d r} + \left( k^2 + \lambda - \frac{N^2}{r^2} \right) R(r) = 0. \label{eqn:R}
\end{align}


First, we solve \eqref{eqn:R} for $R(r)$.
Consider the change of variables
\begin{align}
	\tilde{r} = r \sqrt{k^2 + \lambda}.
\end{align}
By the chain rule, derivatives in $\tilde{r}$ become
\begin{align}
	\frac{\d R}{\d r} &= \frac{\d \tilde{r}}{\d r} \frac{\d R}{\d \tilde{r}} = \sqrt{k^2 + \lambda} \frac{\d R}{\d \tilde{r}} \\
	\frac{\d^2 R}{\d r^2} &= \sqrt{k^2 + \lambda} \frac{\d}{\d \tilde{r}} \left[ \sqrt{k^2 + \lambda} \frac{\d R}{\d \tilde{r}} \right]
							= \left(k^2 + \lambda\right) \frac{\d^2 R}{\d \tilde{r}^2}
\end{align}
Substituting into \eqref{eqn:R}, 
\begin{align}
	\left(k^2 + \lambda\right) \frac{\d^2 R(\tilde{r})}{\d \tilde{r}^2} + 
	\frac{\left(k^2 + \lambda\right)}{\tilde{r}} \frac{\d R(\tilde{r})}{\d \tilde{r}} + 
	\left(k^2 + \lambda\right) \left( 1 - \frac{N^2}{\tilde{r}^2} \right) R(\tilde{r}) = 0.
\end{align}
Upon cancelling factors, we have the final equation, which may be recognised as Bessel's differential equation.
\begin{align}
	\frac{\d^2 R(\tilde{r})}{\d \tilde{r}^2} + 
	\frac{1}{\tilde{r}} \frac{\d R(\tilde{r})}{\d \tilde{r}} + 
	\left( 1 - \frac{N^2}{\tilde{r}^2} \right) R(\tilde{r}) = 0. \label{eqn:bessel_de}
\end{align}
The solution to \eqref{eqn:bessel_de} is a linear combination of Bessel functions of order $N$, and whose argument is $\tilde{r}=r \sqrt{k^2 + \lambda}$.
\begin{align}
	R(r) = c_1 J_N \left( r \sqrt{k^2 + \lambda} \right) + c_2 Y_N \left( r \sqrt{k^2 + \lambda} \right)
\end{align}


Now we turn to the solution of \eqref{eqn:Z}.
The form of the solution of $Z(z)$ is depending on the sign of $\lambda$.
Let $\mu$ be a positive real number.
If the sign is negative so that $\lambda=-\mu^2$, then $Z(z)$ is a linear combination of hyperbolic sine and cosine,
\begin{align}
	Z(z) = c_3 \sinh(\mu z) + c_4 \cosh(\mu z).
\end{align}
On the other hand, if the sign is positive, so that $\lambda=\mu^2$, then $Z(z)$ is a linear combination of sine and cosine,
\begin{align}
	Z(z) = c_3 \sin(\mu z) + c_4 \cos(\mu z).
\end{align}
Finally, if $\lambda=0$, then $Z(z)$ is the equation of a straight line,
\begin{align}
	Z(z) = c_3 z + c_4.
\end{align}

For the sake of simplicity, we can specify that $\lambda=0$.
We have then for the full general solution for a single Fourier mode,
\begin{align}
	u_N(r,z) = R(r)Z(z) = \left( c_1 J_N \left( k r \right) + c_2 Y_N \left( k r \right) \right) \left( c_3 z + c_4 \right),
\end{align}
for any given constants $c_1,c_2,c_4,c_4$.

Since the only purpose of this exact solution is for validation of a correct implementation, we may choose the constants above freely.
In doing so, we may then specify that the boundary conditions for the PDE must correspond with the exact solution.
That is, since we know a priori the solution of the equation, we let the boundary conditions be exactly the value of the solution on the boundary.
This has the benefit of finding the solution we have found above for us to check the method against.
Although this has the distinct disadvantage that we do not make use of any boundary conditions besides Dirichlet.
We will address this at a later with the introduction of Neumann and Sommerfeld boundary conditions.
